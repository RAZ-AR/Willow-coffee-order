# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ

## –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–≥–¥–∞ –≤—ã –¥–µ–ª–∞–ª–∏ –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ Mini App:
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω" –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å
- ‚ùå –í –ª–æ–≥–∞—Ö Render –Ω–µ –±—ã–ª–æ POST /api/order
- ‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å

## –ü—Ä–∏—á–∏–Ω–∞

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–æ–ª—É—á–∞–ª–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç Telegram –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–ª–æ –≤ **—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º** —Å `userId = "0000"`.

–í —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ:
- API **–ù–ï –≤—ã–∑—ã–≤–∞–ª—Å—è**
- –í–æ–∑–≤—Ä–∞—â–∞–ª–∏—Å—å **–º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å (—Å mock –¥–∞–Ω–Ω—ã–º–∏)
- –ù–æ —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑ **–Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è** –≤ –±–∞–∑–µ

## –†–µ—à–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:

#### 1. `src/hooks/useTelegramAuth.ts`

**–ë—ã–ª–æ:**
```typescript
} else {
  // –í dev —Ä–µ–∂–∏–º–µ –∏–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π ID
  userId = "0000";
  console.log('üß™ Using test mode ID:', userId);
}
```

**–°—Ç–∞–ª–æ:**
```typescript
} else {
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–ª–∏ –±–µ—Ä–µ–º –∏–∑ localStorage —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
  userId = generateTestUserId();
  console.log('üîÑ Using generated/stored user ID:', userId);
  console.log('‚ö†Ô∏è  No real Telegram data detected - using fallback ID');
}
```

#### 2. `src/hooks/useApi.ts`

**–£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –±–ª–æ–∫–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π test mode:**
```typescript
// –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º - –£–î–ê–õ–ï–ù–û
if (currentTgId === "0000") {
  return { /* mock data */ };
}
```

–¢–µ–ø–µ—Ä—å **–≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏** (`register`, `getStars`, `submitOrder`) **–≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—é—Ç API**.

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
User –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Mini App
  ‚Üì
Telegram –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è
  ‚Üì
userId = "0000" (test mode)
  ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∑–∞–∫–∞–∑
  ‚Üì
submitOrder –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: if (currentTgId === "0000")
  ‚Üì
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç MOCK –¥–∞–Ω–Ω—ã–µ { order_id: "o_test_...", ... }
  ‚Üì
Modal –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è ‚úÖ
  ‚Üì
–ù–û API –Ω–µ –≤—ã–∑–≤–∞–Ω ‚ùå
  ‚Üì
–ó–∞–∫–∞–∑ –Ω–µ —Å–æ–∑–¥–∞–Ω –≤ –ë–î ‚ùå
  ‚Üì
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã ‚ùå
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
User –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Mini App
  ‚Üì
Telegram –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è
  ‚Üì
userId = generateTestUserId() (–Ω–∞–ø—Ä–∏–º–µ—Ä: 456789)
  ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∑–∞–∫–∞–∑
  ‚Üì
submitOrder –≤—ã–∑—ã–≤–∞–µ—Ç POST /api/order —Å userId: 456789
  ‚Üì
Backend —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ ‚úÖ
  ‚Üì
Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚úÖ
  ‚Üì
Modal –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –†–ï–ê–õ–¨–ù–´–ú order_id ‚úÖ
```

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –®–∞–≥ 1: –ü–æ–¥–æ–∂–¥–∏—Ç–µ –¥–µ–ø–ª–æ—è (2-3 –º–∏–Ω—É—Ç—ã)

Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
https://dashboard.render.com/web/srv-ctnuaefqf0us73bu1cu0/deploys

### –®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ Mini App

1. –û—Ç–∫—Ä–æ–π—Ç–µ @Willow_coffee_bot –≤ Telegram
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "‚òï –ó–∞–∫–∞–∑–∞—Ç—å"
3. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
4. –û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Render

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://dashboard.render.com/web/srv-ctnuaefqf0us73bu1cu0/logs
2. –ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:

```
üõí Order request from user: 456789
‚úÖ Order created: o_176...
‚≠ê Added X stars to card XXXX
üì§ Sending notifications...
üì® Telegram API response: { ok: true, result: { message_id: ... } }
‚úÖ Message sent to 456789
‚úÖ Message sent to -1003082827591
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram

–í—ã –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å:
- ‚úÖ –õ–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç @Willow_coffee_bot —Å –¥–µ—Ç–∞–ª—è–º–∏ –∑–∞–∫–∞–∑–∞
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É "Willow order"

## –ï—Å–ª–∏ –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ù–ï –ø—Ä–∏—à–ª–æ

**–ü—Ä–∏—á–∏–Ω–∞:** –í—ã –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–∏ –±–æ—Ç–∞!

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://t.me/Willow_coffee_bot
2. –ù–∞–∂–º–∏—Ç–µ **START**
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
4. –°–¥–µ–ª–∞–π—Ç–µ –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑

## –ï—Å–ª–∏ –≥—Ä—É–ø–ø–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ù–ï –ø—Ä–∏—à–ª–æ

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–æ—Ç –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É –∏–ª–∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É "Willow order"
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ—Ç —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ GROUP_CHAT_ID –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Render

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç generateTestUserId()

```typescript
const generateTestUserId = () => {
  const key = "test_user_id";
  try {
    const stored = localStorage.getItem(key);
    if (stored) return parseInt(stored);
    const newId = (Math.random() * 1_000_000) | 0;
    localStorage.setItem(key, String(newId));
    return newId;
  } catch {
    return (Math.random() * 1_000_000) | 0;
  }
};
```

–§—É–Ω–∫—Ü–∏—è:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç localStorage –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ ID
2. –ï—Å–ª–∏ –µ—Å—Ç—å - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π ID –¥–ª—è —ç—Ç–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞)
3. –ï—Å–ª–∏ –Ω–µ—Ç - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π ID –æ—Ç 0 –¥–æ 999,999
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ localStorage –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Å–µ—Å—Å–∏–π

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–∏–Ω ID (–≤ —Ä–∞–º–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞)
- –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö Telegram –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—á–µ–º—É Telegram –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è?

Telegram WebApp API –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ **—Ç–æ–ª—å–∫–æ** –∫–æ–≥–¥–∞:
1. App –æ—Ç–∫—Ä—ã—Ç–æ **—á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞** (@Willow_coffee_bot)
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** Telegram (iOS/Android)
3. **–ù–ï** —á–µ—Ä–µ–∑ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ `https://willow-coffee-order.onrender.com/`, —Ç–æ Telegram –¥–∞–Ω–Ω—ã–µ **–ù–ï –±—É–¥—É—Ç –ø–µ—Ä–µ–¥–∞–Ω—ã**.

## –ö–æ–º–º–∏—Ç

```
fix: Remove test mode blocking real API calls

- Changed useTelegramAuth to use generateTestUserId() instead of hardcoded '0000'
- Removed test mode checks in useApi that returned mock data
- Now all orders will reach backend even without real Telegram data
- This fixes the issue where orders showed confirmation modal but didn't send notifications
```

**Commit hash:** 7f4d842

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ
2. ‚è≥ Render –¥–µ–ø–ª–æ–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (2-3 –º–∏–Ω—É—Ç—ã)
3. üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ Mini App
4. üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Render
5. üì® –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `DEBUGGING_ORDER_ISSUE.md` —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è.
