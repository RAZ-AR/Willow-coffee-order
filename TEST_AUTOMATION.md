# ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Willow Coffee

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
src/
‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îú‚îÄ‚îÄ setup.ts                 # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ order-flow.test.ts   # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ e2e/
‚îÇ       ‚îî‚îÄ‚îÄ order-flow.spec.ts   # End-to-End —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useTelegramAuth.test.ts  # –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ useLoyalty.test.ts       # –¢–µ—Å—Ç—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ useApi.test.ts           # –¢–µ—Å—Ç—ã API
```

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### Vitest (Unit & Integration —Ç–µ—Å—Ç—ã)
- **@testing-library/react** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **@testing-library/jest-dom** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç—á–µ—Ä—ã
- **@testing-library/user-event** - —Å–∏–º—É–ª—è—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **jsdom** - DOM –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

### Playwright (E2E —Ç–µ—Å—Ç—ã)
- **@playwright/test** - –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã
- **playwright** - –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –¥–≤–∏–∂–∫–∏

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

```bash
# Unit –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
npm run test              # –ó–∞–ø—É—Å–∫ –≤ watch —Ä–µ–∂–∏–º–µ
npm run test:run          # –†–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫
npm run test:ui           # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å Vitest
npm run test:coverage     # –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞

# E2E —Ç–µ—Å—Ç—ã
npm run test:e2e          # –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã
npm run test:e2e:ui       # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å Playwright
npm run test:e2e:report   # –û—Ç—á–µ—Ç –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

# –í—Å–µ —Ç–µ—Å—Ç—ã
npm run test:all          # Unit + E2E
```

## üìã –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### ‚úÖ Unit —Ç–µ—Å—Ç—ã

#### useTelegramAuth.test.ts
- [x] –í–æ–∑–≤—Ä–∞—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ ID "0000" –±–µ–∑ Telegram –¥–∞–Ω–Ω—ã—Ö
- [x] –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ ID –∏–∑ Telegram WebApp
- [x] –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ ID –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- [x] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Telegram –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ debug/force —Ä–µ–∂–∏–º–æ–≤
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –≤–∞–ª–∏–¥–Ω–æ–≥–æ tg –æ–±—ä–µ–∫—Ç–∞
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ö–∞—Ä–¥–∫–æ–¥–∞ 128136200
- [x] –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

#### useLoyalty.test.ts
- [x] –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ä—Ç—ã –±–µ–∑ –∞–≤—Ç–æ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ä—Ç—ã
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
- [x] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ localStorage
- [x] –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [x] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–æ–≥–æ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [x] –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ reset=1
- [x] –û–ø—Ä–æ—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã –∏ –∑–≤–µ–∑–¥
- [x] –§—É–Ω–∫—Ü–∏—è updateStars

#### useApi.test.ts
- [x] –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º —Å –º–æ–∫-–¥–∞–Ω–Ω—ã–º–∏
- [x] –†–µ–∞–ª—å–Ω—ã–µ API –≤—ã–∑–æ–≤—ã
- [x] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- [x] –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–≤–µ–∑–¥
- [x] –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –æ—à–∏–±–æ–∫
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ JSON
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ tgWebAppData

### ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### order-flow.test.ts
- [x] –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É –∑–∞–∫–∞–∑–∞ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
- [x] –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É –∑–∞–∫–∞–∑–∞ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [x] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
- [x] –†–∞—Å—á–µ—Ç –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∑–≤–µ–∑–¥

### ‚úÖ E2E —Ç–µ—Å—Ç—ã

#### order-flow.spec.ts
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ä—Ç—ã –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
- [x] –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É –∑–∞–∫–∞–∑–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω—ã
- [x] –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç –æ–±—â–µ–π —Å—É–º–º—ã
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –∑–≤–µ–∑–¥
- [x] –†–∞–∑–ª–∏—á–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã
- [x] –†–∞–∑–ª–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- [x] –°–±—Ä–æ—Å localStorage

## üéØ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ê–Ω—Ç–∏—Ä–µ–≥—Ä–µ—Å—Å–∏—è
- ‚ùå **–•–∞—Ä–¥–∫–æ–¥ ID 128136200** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ useTelegramAuth.test.ts
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** - –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ useLoyalty.test.ts
- ‚úÖ **–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º ID 0000** - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –≤—Å–µ—Ö —Ç–µ—Å—Ç–∞—Ö
- ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö

### –§–ª–æ—É —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ /start** - –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–≤–µ–∑–¥—ã** - –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∑–∞ –∑–∞–∫–∞–∑—ã
- ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –∑–≤–µ–∑–¥–∞–º–∏** - —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è API response
- ‚úÖ **–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º** - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –æ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã

### vitest.config.ts
```typescript
export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.ts']
  }
})
```

### playwright.config.ts
```typescript
export default defineConfig({
  testDir: './src/test/e2e',
  use: {
    baseURL: 'http://localhost:5173',
    trace: 'on-first-retry'
  },
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:5173'
  }
})
```

### src/test/setup.ts
- –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ Telegram WebApp API
- –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ localStorage
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ window.location
- –°–±—Ä–æ—Å –º–æ–∫–æ–≤ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º

## üö® –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –î–ª—è –Ω–æ–≤–æ–≥–æ —Ö—É–∫–∞:
```typescript
// src/hooks/newHook.test.ts
import { describe, it, expect, vi } from 'vitest'
import { renderHook } from '@testing-library/react'
import { newHook } from './newHook'

describe('newHook', () => {
  it('should do something', () => {
    const { result } = renderHook(() => newHook())
    expect(result.current).toBeDefined()
  })
})
```

### –î–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:
```typescript
// src/components/NewComponent.test.tsx
import { describe, it, expect } from 'vitest'
import { render, screen } from '@testing-library/react'
import { NewComponent } from './NewComponent'

describe('NewComponent', () => {
  it('should render correctly', () => {
    render(<NewComponent />)
    expect(screen.getByRole('button')).toBeInTheDocument()
  })
})
```

### –î–ª—è –Ω–æ–≤–æ–≥–æ E2E —Å—Ü–µ–Ω–∞—Ä–∏—è:
```typescript
// src/test/e2e/new-feature.spec.ts
import { test, expect } from '@playwright/test'

test('should test new feature', async ({ page }) => {
  await page.goto('/')
  await expect(page.locator('[data-testid="feature"]')).toBeVisible()
})
```

## üìä –û—Ç—á–µ—Ç—ã

### Vitest Coverage
```bash
npm run test:coverage
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç coverage/ –ø–∞–ø–∫—É —Å HTML –æ—Ç—á–µ—Ç–æ–º
```

### Playwright Report
```bash
npm run test:e2e:report
# –û—Ç–∫—Ä—ã–≤–∞–µ—Ç HTML –æ—Ç—á–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
```

## ‚ö° CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```yaml
# .github/workflows/test.yml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - run: npm run test:run
      - run: npm run test:e2e
```

## üé≠ –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

### Telegram WebApp
```typescript
window.Telegram = {
  WebApp: {
    initDataUnsafe: { user: { id: 123456 } }
  }
}
```

### API –æ—Ç–≤–µ—Ç—ã
```typescript
global.fetch = vi.fn().mockResolvedValue({
  ok: true,
  json: async () => ({ card: '1234', stars: 5 })
})
```

### localStorage
```typescript
const localStorageMock = {
  getItem: vi.fn(),
  setItem: vi.fn(),
  removeItem: vi.fn()
}
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞: –¶–µ–ª—å >80%
- –•—É–∫–∏: 95%+
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: 85%+
- –£—Ç–∏–ª–∏—Ç—ã: 90%+

### E2E –ø–æ–∫—Ä—ã—Ç–∏–µ: –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–ª–æ—É
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- ‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∑–≤–µ–∑–¥
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–∏!